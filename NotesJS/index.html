<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta charset="utf-8" />
    <link href="Content/bootstrap.min.css" rel="stylesheet" />
    <link href="Content/bootstrap-theme.min.css" rel="stylesheet" />
    <link href="Content/bootstrap-datetimepicker.css" rel="stylesheet" />
    <link href="Content/style.css" rel="stylesheet" />
    <!--
    ----------------------
    My ToDo's
    ----------------------
    0) Change priority Selection => 3 radio buttons with a picture
    1) Change color depening on the due date (red, orange, green)
    2) Show all or just pending Notes => hack near the Status Column?
    3) Export function (xml/json)
    4) Autosave function
    5) File upload function (add icons (file, image, etc.) to the output)
    5.1) If allready an existing attachement => add
    5.2) Add remove button for a file
    6) Move note.init() to a more suitable location
    -->
</head>
<body id="home">
    <!-- Header -->
    <header>
        <!-- Jumbotron Header -->
        <section class="jumbotron">
            <div class="container">
                <h1></h1>
                <p></p>
            </div>
        </section>
        <!-- Navigation Header -->
        <section class="container">
            <!-- Static navbar -->
            <nav class="navbar navbar-default">
                <div class="container-fluid">
                    <div class="navbar-header">
                        <a class="navbar-brand" href="#"><span class="glyphicon glyphicon-plus"></span></a>
                    </div>
                    <div id="navbar" class="navbar-collapse collapse">
                        <ul class="nav navbar-nav">
                            <!--<li class="active"><a href="#">Notes</a></li>-->
                            <!--<li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Dropdown <span class="caret"></span></a>
                                <ul class="dropdown-menu" role="menu">
                                    <li><a href="#">Action</a></li>
                                    <li><a href="#">Another action</a></li>
                                    <li><a href="#">Something else here</a></li>
                                    <li class="divider"></li>
                                    <li class="dropdown-header">Nav header</li>
                                    <li><a href="#">Separated link</a></li>
                                    <li><a href="#">One more separated link</a></li>
                                </ul>
                            </li>-->
                        </ul>
                        <!-- Swap CSS-Style on the right side-->
                        <!--<ul class="nav navbar-nav navbar-right">
                            <li class="active"><a href="./">Default <span class="sr-only">(current)</span></a></li>
                            <li><a href="../navbar-static-top/">Static top</a></li>
                            <li><a href="../navbar-fixed-top/">Fixed top</a></li>
                        </ul>-->
                    </div><!--/.nav-collapse -->
                </div><!--/.container-fluid -->
            </nav>
        </section>
    </header>

    <section class="container">
        <!--Create Note-->
        <div class="panel panel-default">
            <div class="panel-heading">
                <span class="glyphicon glyphicon-file icon"></span>
                Create Note
            </div>
            <div class="panel-body">
                <form id="note-form" role="form">
                    <div class="form-group">
                        <label for="title">Title:</label>
                        <input name="title" class="form-control" id="title">
                    </div>
                    <div class="form-group">
                        <label for="desc">Description:</label>
                        <textarea name="desc" class="form-control" id="desc" rows="6"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Priority:</label>
                        <div class="radio">
                            <label><input type="radio" name="optpriority"><span class="glyphicon glyphicon-circle-arrow-up icon"></span>High</label>
                        </div>
                        <div class="radio">
                            <label><input type="radio" name="optpriority"><span class="glyphicon glyphicon-circle-arrow-left icon"></span>Medium</label>
                        </div>
                        <div class="radio">
                            <label><input type="radio" name="optpriority"><span class="glyphicon glyphicon-circle-arrow-down icon"></span>Low</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Due Date:</label>
                        <div class="input-group date" id="datetimepicker">
                            <input name="duedate" type="text" class="form-control" />
                            <span class="input-group-addon">
                                <span class="glyphicon glyphicon-calendar"></span>
                            </span>
                        </div>
                    </div>
                    <div form-group>
                        <label>Attachements:</label>
                        <div name="upload-drop-zone" class="upload-drop-zone">Drag & Drop your attachements here</div>
                        <output id="upload-output"></output>
                    </div>
                    <button type="submit" class="btn btn-default">Save</button>
                </form>
            </div>
        </div>

        <!-- Display Notes -->
        <div class="panel panel-default">
            <div class="panel-heading">
                <span class="glyphicon glyphicon-list-alt icon"></span>
                Notes
            </div>
            <div class="panel-body">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Status</th>
                            <th>Due</th>
                            <th>Creation</th>
                            <th>Importance</th>
                            <th>Description</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="glyphicon glyphicon-ok icon"></span></td>
                            <td>10.02.2016</td>
                            <td>10.02.2016</td>
                            <td>Icon1</td>
                            <td>In post mean shot ye. There out her child sir his lived. Design at uneasy me seaso</td>
                            <td>
                                <a href="#" class="icon">
                                    <span class="glyphicon glyphicon-pencil"></span>
                                </a>
                                <a href="#" class="icon">
                                    <span class="glyphicon glyphicon-trash"></span>
                                </a>
                            </td>
                        </tr>
                        <tr>
                            <td><span class="glyphicon glyphicon-ok icon"></span></td>
                            <td>10.02.2016</td>
                            <td>10.02.2016</td>
                            <td>Icon2</td>
                            <td>zealously his shy own belonging. Always length letter adieus add number moment she. Promise few compass six several old office</td>
                            <td>
                                <a href="#" class="icon">
                                    <span class="glyphicon glyphicon-pencil"></span>
                                </a>
                                <a href="#" class="icon">
                                    <span class="glyphicon glyphicon-trash"></span>
                                </a>
                            </td>
                        </tr>
                        <tr>
                            <td><span class="glyphicon glyphicon-remove icon"></span></td>
                            <td>10.02.2016</td>
                            <td>10.02.2016</td>
                            <td>Icon3</td>
                            <td>interested. Described deficient applauded consisted my me do. Passed edward two talent effect seemed engage six</td>
                            <td>
                                <a href="#" class="icon">
                                    <span class="glyphicon glyphicon-pencil"></span>
                                </a>
                                <a href="#" class="icon">
                                    <span class="glyphicon glyphicon-trash"></span>
                                </a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section><!--container-->

    <footer></footer>
    <script src="Scripts/jquery-1.9.0.min.js"></script>
    <script src="Scripts/bootstrap.min.js"></script>
    <script src="Scripts/moment.min.js"></script>
    <script src="Scripts/bootstrap-datetimepicker.min.js"></script>
    <script>
        $(function () {
            $('#datetimepicker').datetimepicker({
                // http://momentjs.com/docs/#/displaying/format/

            });

            // Drag & Drop for attachements
            var $dragzone = $(".upload-drop-zone");
            var $uploadOutput = $('#upload-output');

            $dragzone.on('dragenter', function (e) {
                e.stopPropagation();
                e.preventDefault();
                $(this).css('border', '2px solid #ccc');
            });
            $dragzone.on('dragleave', function (e) {
                e.stopPropagation();
                e.preventDefault();
                $(this).css('border', '2px dashed #ccc');
            });
            $dragzone.on('dragover', function (e) {
                e.stopPropagation();
                e.preventDefault();
            });
            $dragzone.on('drop', function (e) {
                $(this).css('border', '2px dashed #ccc');
                e.preventDefault();
                var files = e.originalEvent.dataTransfer.files;
                // Storing process
                note.addAttachement(files, $dragzone);

            });
            $(document).on('dragenter', function (e) {
                // Prevents the default action of the browser to open the file in the window
                e.stopPropagation();
                e.preventDefault();
            });
            $(document).on('dragover', function (e) {
                // Prevents the default action of the browser to open the file in the window
                e.stopPropagation();
                e.preventDefault();
            });
            $(document).on('drop', function (e) {
                // Prevents the default action of the browser to open the file in the window
                e.stopPropagation();
                e.preventDefault();
            });

            $('button.btn.btn-default').on('click', function () {
                var formData = $("#note-form").serialize();
                note.serialize(formData);
            });

            var utility = {
                createGuid: function () {
                    'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
                        var r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8);
                        return v.toString(16);
                    });
                }
            };

            function NoteObject(id){
                this.uid = id;
                this.attachements = [];
                this.serializedFormData = "";
            };

            var note = {
                counter: 1,
                output: [],
                init : function() {
                    this.currentWorkingObject = new NoteObject(utility.createGuid());
                },
                addAttachement: function (files, obj) {
                    // Display a message concerning the selected files & store the file in the local storage
                    for (var i = 0, f; f = files[i]; i++) {
                        var fileReader = new FileReader();
                        fileReader.onload = (function (file, curObject) {
                            return function (evt) {
                                // Read out file contents as a data URL => result => base64 encoded data string
                                var base64File = evt.target.result;
                                curObject.attachements.push(base64File);
                            }
                        })(f, this.currentWorkingObject);

                        fileReader.readAsDataURL(f);

                        // Display
                        this.displayOutputMessage(f);
                    }
                    $uploadOutput.html('<ul>' + this.output.join('') + '</ul>');
                },
                displayOutputMessage: function (f) {
                    this.output.push('<li><strong>',
                            escape(f.name),
                            '</strong> (',
                            f.type || 'n/a', ') - ',
                            f.size, ' bytes, last modified: ',
                            f.lastModifiedDate.toLocaleDateString(), '</li>');
                },
                serialize: function (form) {
                    this.currentWorkingObject.serializedFormData = form;
                    try {
                        localStorage.setItem(this.currentWorkingObject.uid, this.currentWorkingObject);
                    } catch (e) {
                        console.log("Storage failed: " + e);
                    }
                }
            };

            note.init(); // move to a more suitable place later
        });
    </script>
</body>
</html>
